"use strict";(self.webpackChunkfruit_app=self.webpackChunkfruit_app||[]).push([[5225],{35225:(e,i,d)=>{d.r(i),d.d(i,{default:()=>N});var l=d(65043),s=d(23927),n=d(46909),t=d(59748),r=d(22019),o=d(6051),a=d(3188),u=d(94434),v=d(20691),c=d(49757),h=d(27210),p=d(97107),m=(d(39470),d(76191)),A=d(62058),g=d(49804),x=d(86213),y=d(11238),j=d(86178),f=d.n(j),I=d(78745),b=d(1457),w=d(1880),S=d(86111),$=d.n(S),k=d(70579);const F="https://majesticmall.net/api",{Title:D}=s.A,{confirm:C}=n.A,N=()=>{const[e,i]=(0,l.useState)([]),d=w.A.get("token"),s=d?$().AES.decrypt(d,"Abhinanadan02").toString($().enc.Utf8):null,[j,S]=(0,l.useState)([]),[C,N]=(0,l.useState)(""),[O,_]=(0,l.useState)([null,null]),[B,P]=(0,l.useState)(!1),[q,E]=(0,l.useState)([]),[z,T]=(0,l.useState)(!1),[M,R]=(0,l.useState)(null),[L,W]=(0,l.useState)(null),[Y,V]=(0,l.useState)(!1),[Q]=t.A.useForm();(0,l.useEffect)((()=>{U(),K()}),[]),(0,l.useEffect)((()=>{X()}),[C,O,e]);const U=async()=>{P(!0);try{const e=await x.A.get(`${F}/user/getallOrder`,{headers:{Authorization:`Bearer ${s}`}});if(200===e.status){const d=e.data.success.filter((e=>"normal"===e.orderType)),l=J(d);i(l),S(l)}}catch(e){r.Ay.error("Failed to fetch orders"),console.error("Error fetching orders:",e)}finally{P(!1)}},K=async()=>{try{const e=await x.A.get(`${F}/user/getAlldriver`,{headers:{Authorization:`Bearer ${s}`}});if(200===e.status){const i=Array.isArray(e.data.success)?e.data.success:[];E(i)}}catch(e){r.Ay.error("Failed to fetch drivers")}},[G,H]=(0,l.useState)(null),J=e=>e.map(((e,i)=>{var d,l,s,n,t,r,o,a,u,v,c,h,p,m,A,x,y,j,I,b,w,S,$,F,D,C,N,O,_,B,P,q,E,z,M,L,W;return{key:i+1,Sno:i+1,orderId:e._id,customerName:null!==(d=e.shippingAddress)&&void 0!==d&&d.fullName?null===(l=e.shippingAddress)||void 0===l?void 0:l.fullName:null===(s=e.shippingAddress)||void 0===s?void 0:s.name,searchableContent:`\n        ${e._id}\n        ${null!==(n=e.shippingAddress)&&void 0!==n&&n.name?null===(t=e.shippingAddress)||void 0===t?void 0:t.name:null===(r=e.shippingAddress)||void 0===r?void 0:r.fullName}\n        ${null!==(o=e.shippingAddress)&&void 0!==o&&o.street?null===(a=e.shippingAddress)||void 0===a?void 0:a.street:null===(u=e.shippingAddress)||void 0===u?void 0:u.address1}\n        ${null!==(v=e.shippingAddress)&&void 0!==v&&v.city?null===(c=e.shippingAddress)||void 0===c?void 0:c.city:null===(h=e.shippingAddress)||void 0===h?void 0:h.address2}\n        ${null===(p=e.shippingAddress)||void 0===p?void 0:p.state}\n        ${null===(m=e.shippingAddress)||void 0===m?void 0:m.pincode}\n        ${null===(A=e.shippingAddress)||void 0===A?void 0:A.country}\n        ${null!==(x=e.shippingAddress)&&void 0!==x&&x.number?null===(y=e.shippingAddress)||void 0===y?void 0:y.number:null===(j=e.shippingAddress)||void 0===j?void 0:j.mobile}\n        ${null===(I=e.shippingAddress)||void 0===I?void 0:I.email}\n        ${null===(b=e.items)||void 0===b?void 0:b.map((e=>`${e.name} ${e.quantity} ${e.price}`)).join(" ")}\n        ${e.totalAmount}\n        ${e.paymentmethod}\n        ${e.status}\n        ${e.remarks}\n      `.toLowerCase(),address:(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{children:null!==(w=e.shippingAddress)&&void 0!==w&&w.fullName?null===(S=e.shippingAddress)||void 0===S?void 0:S.fullName:null===($=e.shippingAddress)||void 0===$?void 0:$.name}),(0,k.jsx)("p",{children:null!==(F=e.shippingAddress)&&void 0!==F&&F.street?null===(D=e.shippingAddress)||void 0===D?void 0:D.street:null===(C=e.shippingAddress)||void 0===C?void 0:C.address1}),(0,k.jsxs)("p",{children:[null!==(N=e.shippingAddress)&&void 0!==N&&N.city?null===(O=e.shippingAddress)||void 0===O?void 0:O.city:null===(_=e.shippingAddress)||void 0===_?void 0:_.address2,", ",null===(B=e.shippingAddress)||void 0===B?void 0:B.state," ",null===(P=e.shippingAddress)||void 0===P?void 0:P.pincode]}),(0,k.jsx)("p",{children:null===(q=e.shippingAddress)||void 0===q?void 0:q.country}),(0,k.jsxs)("p",{children:["Phone:",null!==(E=e.shippingAddress)&&void 0!==E&&E.number?null===(z=e.shippingAddress)||void 0===z?void 0:z.number:null===(M=e.shippingAddress)||void 0===M?void 0:M.mobile]}),(0,k.jsxs)("p",{children:["Email: ",null===(L=e.shippingAddress)||void 0===L?void 0:L.email]})]}),products:(0,k.jsx)("ul",{children:null===(W=e.items)||void 0===W?void 0:W.map(((i,d)=>(0,k.jsxs)("li",{children:[i.name," - ",i.quantity," x ",i.price," INR - ",i.weight,(0,k.jsx)(g.u6n,{style:{cursor:"pointer",marginLeft:"10px"},onClick:()=>{return d=e._id,l=i,s=e.discount,R({orderId:d,product:l,discount:s}),Q.setFieldsValue({quantity:l.quantity,weight:l.weight}),void T(!0);var d,l,s}})]},d)))}),amount:e.totalAmount,discount:e.discount,date:f()(e.orderDate).format("DD/MM/YYYY"),dateForFiltering:e.orderDate,additionalInstructions:e.additionalInstructions,status:e.status,paymentmethod:e.paymentMethod,remarks:e.remarks,deliveryBoyId:e.deliveryBoyId,originalData:e}})),X=()=>{let i=[...e];if(C){const e=C.toLowerCase();i=i.filter((i=>i.searchableContent.includes(e)))}if(null!==O&&void 0!==O&&O[0]&&null!==O&&void 0!==O&&O[1]){const e=O[0].startOf("day").valueOf(),d=O[1].endOf("day").valueOf();i=i.filter((i=>{const l=new Date(i.dateForFiltering).valueOf();return l>=e&&l<=d}))}0===i.length&&(C||null!==O&&void 0!==O&&O[0]&&null!==O&&void 0!==O&&O[1])&&r.Ay.warning("No orders found with the applied filters."),S(i)},Z=e=>{W(e),V(!0),(async e=>{try{const i=await x.A.get(`${F}/user/getSalesOrder/${e}`,{headers:{Authorization:`Bearer ${s}`}});i.data.success?H(i.data.data):console.error("Sales order not found")}catch(i){console.error("Error fetching sales order:",i)}})(null===e||void 0===e?void 0:e._id)},ee=[{title:"SNo",dataIndex:"Sno",width:70},{title:"Order ID",dataIndex:"orderId",width:150},{title:"Customer Name",dataIndex:"customerName",width:150},{title:"Total Amount",dataIndex:"amount",width:150},{title:"Date",dataIndex:"date",width:150},{title:"Status",dataIndex:"status",width:150},{title:"Actions",dataIndex:"actions",width:250,render:(e,i)=>{var d;return(0,k.jsxs)(o.A,{children:[(0,k.jsx)(a.Ay,{icon:(0,k.jsx)(m.A,{}),onClick:()=>Z(i.originalData),children:"View Details"}),null===i.deliveryBoyId?(0,k.jsx)(u.A,{style:{width:150},placeholder:"Select Delivery Boy",onChange:e=>(async(e,i)=>{try{200===(await x.A.post(`${F}/user/assignDeliveryBoy`,{orderId:e,deliveryBoyId:i},{headers:{Authorization:`Bearer ${s}`}})).status&&(r.Ay.success("Delivery boy assigned successfully"),U())}catch(d){r.Ay.error("Failed to assign delivery boy"),console.error("Error assigning delivery boy:",d)}})(i.orderId,e),children:null===q||void 0===q?void 0:q.map((e=>(0,k.jsx)(u.A.Option,{value:e._id,children:null===e||void 0===e?void 0:e.name},e._id)))}):(0,k.jsx)("span",{children:null===(d=i.deliveryBoyId)||void 0===d?void 0:d.name})]})}}],ie=[{title:"Item Name",dataIndex:"name",key:"name"},{title:"Quantity",dataIndex:"quantity",key:"quantity"},{title:"Weight",dataIndex:"weight",key:"weight"},{title:"Price",dataIndex:"price",key:"price"}];return(0,k.jsxs)("div",{children:[(0,k.jsx)(I.N9,{position:"top-right",autoClose:3e3}),(0,k.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,k.jsx)(D,{level:3,children:"Orders"}),(0,k.jsxs)(o.A,{children:[(0,k.jsx)(h.A,{placeholder:"Search orders",prefix:(0,k.jsx)(A.A,{}),value:C,onChange:e=>{N(e.target.value)},style:{width:200}}),(0,k.jsx)(p.A.RangePicker,{value:O,onChange:e=>{_(e)}}),(0,k.jsx)(a.Ay,{type:"primary",onClick:()=>{const e=j.map((e=>{let{searchableContent:i,products:d,address:l,actions:s,dateForFiltering:n,...t}=e;return t})),i=y.Wp.json_to_sheet(e),d=y.Wp.book_new();y.Wp.book_append_sheet(d,i,"Orders"),y._h(d,"orders.xlsx")},icon:(0,k.jsx)(b.A,{size:16}),children:"Export to Excel"})]})]}),(0,k.jsx)(c.A,{columns:ee,dataSource:j,scroll:{x:"max-content"},pagination:{pageSize:10},components:{header:{cell:e=>(0,k.jsx)("th",{...e,style:{...e.style,background:"linear-gradient(#000,#000,#000)",color:"white"}})}},loading:B}),(()=>{var e,i,d,l,s,t,r,o,a,u,h,p,m,A,g,x,y,j,f,I,b,w,S,$,F;return(0,k.jsx)(n.A,{title:"Order Details",visible:Y,onCancel:()=>V(!1),footer:null,width:800,children:(0,k.jsxs)("div",{children:[(0,k.jsxs)(v.A,{bordered:!0,column:2,layout:"horizontal",children:[(0,k.jsx)(v.A.Item,{label:"Order Id",children:null===L||void 0===L?void 0:L._id}),(0,k.jsxs)(v.A.Item,{label:"Date/Time",children:[new Date(null===L||void 0===L?void 0:L.orderDate).toLocaleDateString()," ",(0,k.jsxs)("p",{children:[" ",new Date(null===L||void 0===L?void 0:L.orderDate).toLocaleTimeString()]})]}),(0,k.jsx)(v.A.Item,{label:"Payment Method",children:null===L||void 0===L?void 0:L.paymentMethod}),(0,k.jsx)(v.A.Item,{label:"Status",children:null===L||void 0===L?void 0:L.status})]}),(0,k.jsx)("h4",{children:"Items:"}),(0,k.jsx)(v.A,{bordered:!0,column:1,children:(0,k.jsx)(v.A.Item,{label:"Products",children:(0,k.jsx)("ul",{children:null===L||void 0===L||null===(e=L.items)||void 0===e?void 0:e.map(((e,i)=>(0,k.jsxs)("li",{children:[e.name," - ",e.quantity," x ",e.price," INR -"," ",e.weight]},i)))})})}),(null===G||void 0===G?void 0:G.orderId)===(null===L||void 0===L?void 0:L._id)?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("h4",{style:{marginTop:"20px"},children:"Sales Order:"}),(0,k.jsx)(c.A,{dataSource:null===G||void 0===G?void 0:G.items,columns:ie,rowKey:"itemId",pagination:!1}),(0,k.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,k.jsx)("strong",{children:"Total Sales Amount:"})," ",null===G||void 0===G||null===(i=G.totalAmount)||void 0===i?void 0:i.toFixed(2)]})]}):"",(0,k.jsx)("h4",{children:"Shipping Address:"}),(0,k.jsxs)(v.A,{bordered:!0,column:1,children:[(0,k.jsx)(v.A.Item,{label:"Customer Name",children:null!==L&&void 0!==L&&null!==(d=L.shippingAddress)&&void 0!==d&&d.fullName?null===L||void 0===L||null===(l=L.shippingAddress)||void 0===l?void 0:l.fullName:null===L||void 0===L||null===(s=L.shippingAddress)||void 0===s?void 0:s.name}),(0,k.jsx)(v.A.Item,{label:"Address",children:(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{children:null!==L&&void 0!==L&&null!==(t=L.shippingAddress)&&void 0!==t&&t.fullName?null===L||void 0===L||null===(r=L.shippingAddress)||void 0===r?void 0:r.fullName:null===L||void 0===L||null===(o=L.shippingAddress)||void 0===o?void 0:o.name}),(0,k.jsx)("p",{children:null!==L&&void 0!==L&&null!==(a=L.shippingAddress)&&void 0!==a&&a.street?null===L||void 0===L||null===(u=L.shippingAddress)||void 0===u?void 0:u.street:null===L||void 0===L||null===(h=L.shippingAddress)||void 0===h?void 0:h.address1}),(0,k.jsxs)("p",{children:[null!==L&&void 0!==L&&null!==(p=L.shippingAddress)&&void 0!==p&&p.city?null===L||void 0===L||null===(m=L.shippingAddress)||void 0===m?void 0:m.city:null===L||void 0===L||null===(A=L.shippingAddress)||void 0===A?void 0:A.address2,", ",null===L||void 0===L||null===(g=L.shippingAddress)||void 0===g?void 0:g.state," ",null===L||void 0===L||null===(x=L.shippingAddress)||void 0===x?void 0:x.pincode]}),(0,k.jsx)("p",{children:null===L||void 0===L||null===(y=L.shippingAddress)||void 0===y?void 0:y.country}),(0,k.jsxs)("p",{children:["Phone:"," ",null!==L&&void 0!==L&&null!==(j=L.shippingAddress)&&void 0!==j&&j.number?null===L||void 0===L||null===(f=L.shippingAddress)||void 0===f?void 0:f.number:null===L||void 0===L||null===(I=L.shippingAddress)||void 0===I?void 0:I.mobile]}),(0,k.jsxs)("p",{children:["Email: ",null===L||void 0===L||null===(b=L.shippingAddress)||void 0===b?void 0:b.email]})]})})]}),(null===L||void 0===L?void 0:L.additionalInstructions)&&(0,k.jsxs)("div",{children:[(0,k.jsx)("h4",{children:"Additional Instructions:"}),(0,k.jsx)("p",{children:null===L||void 0===L?void 0:L.additionalInstructions})]}),(null===L||void 0===L?void 0:L.remarks)&&(0,k.jsxs)("div",{children:[(0,k.jsx)("h4",{children:"Remarks:"}),(0,k.jsx)("p",{children:null===L||void 0===L?void 0:L.remarks})]}),(null===L||void 0===L?void 0:L.deliveryProof)&&(0,k.jsxs)("div",{children:[(0,k.jsx)("h4",{children:"Deliver Proof:"}),(0,k.jsx)("a",{href:`https://majesticmall.net/driver/${null===L||void 0===L?void 0:L.deliveryProof}`,target:"_blank",children:(0,k.jsx)("img",{src:`https://majesticmall.net/driver/${null===L||void 0===L?void 0:L.deliveryProof}`,alt:"Delivery Proof",style:{borderRadius:"10px",height:"150px",width:"auto"}})})]}),(0,k.jsx)("h5",{children:"Price Breakdown:"}),(0,k.jsxs)(v.A,{bordered:!0,column:1,children:[(0,k.jsxs)(v.A.Item,{label:"Total MRP",children:["\u20b9",null===(w=(null===L||void 0===L?void 0:L.totalAmount)+(null===L||void 0===L?void 0:L.discount)-(null===L||void 0===L?void 0:L.deliveryCharge))||void 0===w?void 0:w.toFixed(2)]}),(0,k.jsxs)(v.A.Item,{label:"Shipping Fees",children:["\u20b9",null===L||void 0===L||null===(S=L.deliveryCharge)||void 0===S?void 0:S.toFixed(2)]}),(0,k.jsxs)(v.A.Item,{label:"Discount",style:{color:"green"},children:["\u20b9",null===L||void 0===L||null===($=L.discount)||void 0===$?void 0:$.toFixed(2)]}),(0,k.jsxs)(v.A.Item,{label:"Total Price",children:["\u20b9",null===L||void 0===L||null===(F=L.totalAmount)||void 0===F?void 0:F.toFixed(2)]})]})]})})})(),(0,k.jsx)(n.A,{title:"Update Product",visible:z,onOk:async()=>{try{const e=await Q.validateFields();console.log("Form Values:",e);const{orderId:i,product:d,discount:l}=M,n=e.price?parseFloat(e.price):d.price,t=e.quantity*n,o=await x.A.get(`${F}/user/getOriginalOrder/${i}`,{headers:{Authorization:`Bearer ${s}`}}),a=o.data.data.items.filter((e=>!(e.name.trim()===d.name.trim()&&e.quantity===d.quantity))),u=t+a.reduce(((e,i)=>e+i.quantity*i.price),0);200===(await x.A.post(`${F}/user/saveSalesOrder`,{orderId:i,discount:l,totalAmount:u,items:[{itemId:d.itemId,name:d.name.trim(),quantity:e.quantity,weight:e.weight,price:n},...a]},{headers:{Authorization:`Bearer ${s}`}})).status&&(r.Ay.success("Sales order updated successfully"),T(!1),V(!1),Q.resetFields(),U())}catch(e){r.Ay.error("Failed to update sales order"),console.error("Error saving sales order:",e)}},onCancel:()=>{T(!1),Q.resetFields()},children:(0,k.jsxs)(t.A,{form:Q,children:[(0,k.jsx)(t.A.Item,{label:"Quantity",name:"quantity",children:(0,k.jsx)(h.A,{type:"number",min:1})}),(0,k.jsx)(t.A.Item,{label:"Weight",name:"weight",children:(0,k.jsx)(h.A,{})}),(0,k.jsx)(t.A.Item,{label:"Price",name:"price",children:(0,k.jsx)(h.A,{type:"number",min:1})})]})})]})}}}]);
//# sourceMappingURL=5225.7805c665.chunk.js.map