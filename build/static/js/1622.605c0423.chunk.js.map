{"version":3,"file":"static/js/1622.605c0423.chunk.js","mappings":"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","sources":["components/admin/pages/abandoned.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Table, Button, Input, Modal, message, Typography, Space } from 'antd';\r\nimport { SearchOutlined, DeleteOutlined, ExportOutlined } from '@ant-design/icons';\r\nimport { FileSpreadsheet, Trash2 } from 'lucide-react';\r\nimport axios from 'axios';\r\nimport moment from 'moment';\r\nimport * as XLSX from 'xlsx';\r\nimport Cookies from 'js-cookie';\r\nimport CryptoJS from 'crypto-js';\r\n\r\nconst { confirm } = Modal;\r\nconst { Title } = Typography;\r\nconst API_BASE_URL = 'https://majesticmall.net/api/admin';\r\n\r\nconst AbandonedCartList = () => {\r\n  const [abandonedCarts, setAbandonedCarts] = useState([]);\r\n  const [filteredCarts, setFilteredCarts] = useState([]);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [isDeleteModalVisible, setIsDeleteModalVisible] = useState(false);\r\n  const [selectedCartId, setSelectedCartId] = useState(null);\r\n  const encryptionKey = process.env.REACT_APP_ENCRYPTION_KEY;\r\n  const encryptedToken = Cookies.get('token');\r\n  const token = encryptedToken ? CryptoJS.AES.decrypt(encryptedToken, encryptionKey).toString(CryptoJS.enc.Utf8) : null;\r\n\r\n  useEffect(() => {\r\n    fetchAbandonedCarts();\r\n  }, []);\r\n\r\n  const fetchAbandonedCarts = async () => {\r\n    try {\r\n      const response = await axios.get(`${API_BASE_URL}/getAbandoned`);\r\n      const transformedData = transformData(response.data?.abandonedCarts);\r\n      setAbandonedCarts(transformedData);\r\n      setFilteredCarts(transformedData);\r\n    } catch (error) {\r\n      message.error('Failed to fetch abandoned carts');\r\n    }\r\n  };\r\n\r\n  const transformData = (data) => {\r\n    return data?.map((cart, index) => ({\r\n      key: index + 1,\r\n      user: cart.user?.name || 'Anonymous',\r\n      cartItems: cart.cart.map(item => `${item.productname} (x${item.quantity})`).join(', '),\r\n      timestamp: moment(cart.timestamp).format('DD/MM/YYYY, HH:mm'),\r\n      _id: cart._id,\r\n    }));\r\n  };\r\n  const showDeleteConfirm = (id) => {\r\n    confirm({\r\n      title: \"Are you sure you want to delete?\",\r\n      content: \"This action cannot be undone.\",\r\n      okText: \"Yes\",\r\n      okType: \"danger\",\r\n      cancelText: \"No\",\r\n      onOk() {\r\n        handleDeleteCart(id);\r\n      },\r\n      onCancel() {\r\n        // console.log(\"Deletion cancelled\");\r\n      },\r\n    });\r\n  };\r\n  const handleDeleteCart = async () => {\r\n    try {\r\n      await axios.delete(`${API_BASE_URL}/deleteAbandoned/${selectedCartId}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n      message.success('Abandoned cart deleted successfully');\r\n      setIsDeleteModalVisible(false);\r\n      fetchAbandonedCarts();\r\n    } catch (error) {\r\n      message.error('Failed to delete abandoned cart');\r\n    }\r\n  };\r\n\r\n  const handleSearch = (value) => {\r\n    setSearchTerm(value);\r\n    const filtered = abandonedCarts.filter((record) =>\r\n      Object.values(record).some(\r\n        (val) => val && val.toString().toLowerCase().includes(value.toLowerCase())\r\n      )\r\n    );\r\n    setFilteredCarts(filtered);\r\n  };\r\n\r\n  const exportToExcel = () => {\r\n    const dataToExport = filteredCarts.map(({ key, _id, ...rest }) => rest);\r\n    const worksheet = XLSX.utils.json_to_sheet(dataToExport);\r\n    const workbook = XLSX.utils.book_new();\r\n    XLSX.utils.book_append_sheet(workbook, worksheet, 'Abandoned Carts');\r\n    XLSX.writeFile(workbook, 'Abandoned_Carts.xlsx');\r\n  };\r\n\r\n  const columns = [\r\n    { title: 'SNo', dataIndex: 'key', key: 'key' },\r\n    { title: 'User', dataIndex: 'user', key: 'user' },\r\n    { title: 'Cart Items', dataIndex: 'cartItems', key: 'cartItems' },\r\n    { title: 'Timestamp', dataIndex: 'timestamp', key: 'timestamp' },\r\n    {\r\n      title: 'Action',\r\n      key: 'action',\r\n      render: (_, record) => (\r\n        <Button\r\n          type=\"text\"\r\n          icon={<Trash2 color=\"red\" />}\r\n          onClick={() => {\r\n            setSelectedCartId(record._id);\r\n            setIsDeleteModalVisible(true);\r\n          }}\r\n        />\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div>\r\n      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 16 }}>\r\n        <Title level={3}>Abandoned Carts</Title>\r\n        <Space>\r\n\r\n          <Input\r\n            placeholder=\"Search\"\r\n            prefix={<SearchOutlined />}\r\n            value={searchTerm}\r\n            onChange={(e) => handleSearch(e.target.value)}\r\n          />\r\n          <Button type=\"primary\" icon={<FileSpreadsheet size={16} />} onClick={exportToExcel}>\r\n            Export to Excel\r\n          </Button>\r\n        </Space>\r\n      </div>\r\n\r\n\r\n\r\n      <Table\r\n        columns={columns}\r\n        dataSource={filteredCarts}\r\n        pagination={{\r\n          pageSize: 10,\r\n          //showSizeChanger: true, \r\n        }}\r\n        scroll={{ x: 'max-content' }}\r\n        components={{\r\n          header: {\r\n            cell: (props) => (\r\n              <th\r\n                {...props}\r\n                style={{\r\n                  ...props.style,\r\n                  background: 'linear-gradient(#000,#000,#000)',\r\n                  color: 'white',\r\n                }}\r\n              />\r\n            ),\r\n          },\r\n        }}\r\n      />\r\n\r\n      <Modal\r\n        title=\"Delete Abandoned Cart\"\r\n        visible={isDeleteModalVisible}\r\n        onOk={showDeleteConfirm}\r\n        onCancel={() => setIsDeleteModalVisible(false)}\r\n      >\r\n        <p>Are you sure you want to delete this abandoned cart?</p>\r\n      </Modal>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AbandonedCartList;"],"names":["confirm","Modal","Title","Typography","API_BASE_URL","AbandonedCartList","abandonedCarts","setAbandonedCarts","useState","filteredCarts","setFilteredCarts","searchTerm","setSearchTerm","isDeleteModalVisible","setIsDeleteModalVisible","selectedCartId","setSelectedCartId","encryptedToken","Cookies","get","token","CryptoJS","decrypt","process","toString","Utf8","useEffect","fetchAbandonedCarts","async","_response$data","response","axios","transformedData","transformData","data","error","message","map","cart","index","_cart$user","key","user","name","cartItems","item","productname","quantity","join","timestamp","moment","format","_id","handleDeleteCart","delete","headers","Authorization","success","columns","title","dataIndex","render","_","record","_jsx","Button","type","icon","Trash2","color","onClick","_jsxs","children","style","display","alignItems","justifyContent","marginBottom","level","Space","Input","placeholder","prefix","SearchOutlined","value","onChange","e","filtered","filter","Object","values","some","val","toLowerCase","includes","handleSearch","target","FileSpreadsheet","size","exportToExcel","dataToExport","_ref","rest","worksheet","XLSX","json_to_sheet","workbook","book_new","book_append_sheet","Table","dataSource","pagination","pageSize","scroll","x","components","header","cell","props","background","visible","onOk","id","content","okText","okType","cancelText","onCancel"],"sourceRoot":""}