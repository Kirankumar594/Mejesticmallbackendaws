"use strict";(self.webpackChunkfruit_app=self.webpackChunkfruit_app||[]).push([[957],{50957:(e,i,s)=>{s.r(i),s.d(i,{default:()=>$});var l=s(65043),d=s(23927),t=s(46909),n=s(59748),r=s(22019),o=s(6051),a=s(3188),u=s(94434),c=s(20691),v=s(27210),p=s(97107),h=s(49757),m=(s(39470),s(76191)),x=s(62058),A=s(86213),g=s(11238),y=(s(86178),s(78745)),j=s(1457),b=s(1880),f=s(86111),I=s.n(f),D=s(70579);const S="https://majesticmall.net/api",{Title:w}=d.A,{confirm:N}=t.A,$=()=>{const e=b.A.get("token"),i=e?I().AES.decrypt(e,"Abhinanadan02").toString(I().enc.Utf8):null,[s,d]=(0,l.useState)([]),[f,N]=(0,l.useState)([]),[$,C]=(0,l.useState)(""),[k,q]=(0,l.useState)([null,null]),[F,P]=(0,l.useState)(!1),[O,E]=(0,l.useState)([]),[B,_]=(0,l.useState)(!1),[z,R]=(0,l.useState)(null),[W,T]=(0,l.useState)(null),[V,L]=(0,l.useState)(!1),[Q]=n.A.useForm();(0,l.useEffect)((()=>{(async()=>{await M(),await H()})()}),[]),(0,l.useEffect)((()=>{G()}),[$,k,s]);const H=async()=>{P(!0);try{const e=await A.A.get(`${S}/user/getallSubscriptions`,{headers:{Authorization:`Bearer ${i}`}});if(200===e.status){const i=U(e.data.success);d(i),N(i)}}catch(e){r.Ay.error("Failed to fetch subscriptions"),console.error("Error fetching subscriptions:",e)}finally{P(!1)}},M=async()=>{try{const e=await A.A.get(`${S}/user/getAlldriver`,{headers:{Authorization:`Bearer ${i}`}});return 200===e.status&&e.data.success?(E(e.data.success),e.data.success):(console.error("Invalid drivers response format:",e),r.Ay.error("Failed to fetch drivers: Invalid response format"),[])}catch(e){return console.error("Error fetching drivers:",e),r.Ay.error(`Failed to fetch drivers: ${e.message}`),[]}},U=e=>e.map(((e,i)=>{var s,l,d,t,n,r,o,a,u,c,v,p,h,m,x,A,g,y,j,b,f,I,S,w,N,$,C,k,q,F,P;return{key:i+1,Sno:i+1,subscriptionId:e._id,customerName:(null===(s=e.shippingAddress)||void 0===s?void 0:s.fullName)||(null===(l=e.shippingAddress)||void 0===l?void 0:l.name),searchableContent:`\n        ${e._id}\n        ${(null===(d=e.shippingAddress)||void 0===d?void 0:d.fullName)||(null===(t=e.shippingAddress)||void 0===t?void 0:t.name)}\n        ${(null===(n=e.shippingAddress)||void 0===n?void 0:n.street)||(null===(r=e.shippingAddress)||void 0===r?void 0:r.address1)}\n        ${(null===(o=e.shippingAddress)||void 0===o?void 0:o.city)||(null===(a=e.shippingAddress)||void 0===a?void 0:a.address2)}\n        ${null===(u=e.shippingAddress)||void 0===u?void 0:u.state}\n        ${null===(c=e.shippingAddress)||void 0===c?void 0:c.pincode}\n        ${null===(v=e.shippingAddress)||void 0===v?void 0:v.country}\n        ${(null===(p=e.shippingAddress)||void 0===p?void 0:p.number)||(null===(h=e.shippingAddress)||void 0===h?void 0:h.mobile)}\n        ${null===(m=e.shippingAddress)||void 0===m?void 0:m.email}\n        ${null===(x=e.productId)||void 0===x?void 0:x.productname}\n        ${e.quantity}\n        ${null===(A=e.selectedWeight)||void 0===A?void 0:A.price}\n        ${e.productValue}\n        ${e.frequency}\n        ${e.status}\n      `.toLowerCase(),address:(0,D.jsxs)("div",{children:[(0,D.jsx)("p",{children:(null===(g=e.shippingAddress)||void 0===g?void 0:g.fullName)||(null===(y=e.shippingAddress)||void 0===y?void 0:y.name)}),(0,D.jsx)("p",{children:(null===(j=e.shippingAddress)||void 0===j?void 0:j.street)||(null===(b=e.shippingAddress)||void 0===b?void 0:b.address1)}),(0,D.jsxs)("p",{children:[(null===(f=e.shippingAddress)||void 0===f?void 0:f.city)||(null===(I=e.shippingAddress)||void 0===I?void 0:I.address2),", ",null===(S=e.shippingAddress)||void 0===S?void 0:S.state," ",null===(w=e.shippingAddress)||void 0===w?void 0:w.pincode]}),(0,D.jsx)("p",{children:null===(N=e.shippingAddress)||void 0===N?void 0:N.country}),(0,D.jsxs)("p",{children:["Phone:"," ",(null===($=e.shippingAddress)||void 0===$?void 0:$.number)||(null===(C=e.shippingAddress)||void 0===C?void 0:C.mobile)]}),(0,D.jsxs)("p",{children:["Email: ",null===(k=e.shippingAddress)||void 0===k?void 0:k.email]})]}),productDetails:{name:null===(q=e.productId)||void 0===q?void 0:q.productname,quantity:e.quantity,price:null===(F=e.selectedWeight)||void 0===F?void 0:F.price},productname:null===(P=e.productId)||void 0===P?void 0:P.productname,amount:e.productValue,discount:e.discount,startDate:new Date(e.startDate).toLocaleString(),endDate:e.endDate?new Date(e.endDate).toLocaleString():"N/A",frequency:e.frequency,totalOrders:e.totalOrders*(e.quantity||1),status:e.status,remarks:e.remarks,deliveryBoyId:e.deliveryBoyId,originalData:e}})),G=()=>{let e=[...s];if($){const i=$.toLowerCase();e=e.filter((e=>e.searchableContent.includes(i)))}if(null!==k&&void 0!==k&&k[0]&&null!==k&&void 0!==k&&k[1]){const i=k[0].startOf("day").valueOf(),s=k[1].endOf("day").valueOf();e=e.filter((e=>{const l=new Date(e.startDate).valueOf();return l>=i&&l<=s}))}0===e.length&&($||null!==k&&void 0!==k&&k[0]&&null!==k&&void 0!==k&&k[1])&&r.Ay.warning("No subscriptions found with the applied filters."),N(e)},[J,K]=(0,l.useState)(null),X=[{title:"SNo",dataIndex:"Sno",width:70},{title:"Subscription ID",dataIndex:"subscriptionId",width:150},{title:"Customer Name",dataIndex:"customerName",width:150},{title:"Total Amount",dataIndex:"amount",width:150},{title:"Start Date",dataIndex:"startDate",width:150},{title:"Status",dataIndex:"status",width:150},{title:"Actions",dataIndex:"actions",width:300,render:(e,s)=>{var l;return(0,D.jsxs)(o.A,{children:[(0,D.jsx)(a.Ay,{icon:(0,D.jsx)(m.A,{}),onClick:()=>{return e=s.originalData,T(e),void L(!0);var e},children:"View Details"}),"pending"===s.status||"paused"===s.status?(0,D.jsx)(a.Ay,{onClick:()=>(async e=>{try{A.A.get("https://majesticmall.net/api/user/changeSubscriptionStatus/"+e,{headers:{Authorization:`Bearer ${i}`}}).then((function(e){200===e.status&&(y.oR.info("Approved successfully"),window.location.reload())})).catch((function(e){y.oR.info("Not able to complete")}))}catch(s){return console.warn(s),y.oR.info("Not able to complete"),s}})(s.subscriptionId),children:"Approve"}):null===s.deliveryBoyId?(0,D.jsx)(u.A,{style:{width:150},placeholder:"Select Delivery Boy",onChange:e=>(async(e,s)=>{try{200===(await A.A.post(`${S}/user/assignDeliveryBoy1`,{orderId:e,deliveryBoyId:s},{headers:{Authorization:`Bearer ${i}`}})).status&&(y.oR.success("Delivery boy assigned successfully"),H())}catch(l){y.oR.error("Failed to assign delivery boy"),console.error("Error assigning delivery boy:",l)}})(s.subscriptionId,e),children:null===O||void 0===O?void 0:O.map((e=>(0,D.jsx)(u.A.Option,{value:e._id,children:null===e||void 0===e?void 0:e.name},e._id)))}):(0,D.jsx)("span",{children:null===(l=s.deliveryBoyId)||void 0===l?void 0:l.name})]})}}];return(0,D.jsxs)("div",{style:{padding:"20px"},children:[(0,D.jsx)(y.N9,{position:"top-right",autoClose:3e3}),(0,D.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,D.jsx)(w,{level:3,children:"Subscriptions"}),(0,D.jsxs)(o.A,{children:[(0,D.jsx)(v.A,{placeholder:"Search subscriptions",prefix:(0,D.jsx)(x.A,{}),value:$,onChange:e=>{C(e.target.value)},style:{width:200}}),(0,D.jsx)(p.A.RangePicker,{value:k,onChange:e=>{q(e)}}),(0,D.jsx)(a.Ay,{type:"primary",onClick:()=>{const e=f.map((e=>{let{searchableContent:i,productDetails:s,address:l,actions:d,...t}=e;return t})),i=g.Wp.json_to_sheet(e),s=g.Wp.book_new();g.Wp.book_append_sheet(s,i,"Subscriptions"),g._h(s,"subscriptions.xlsx")},icon:(0,D.jsx)(j.A,{size:16}),children:"Export to Excel"})]})]}),(0,D.jsx)(h.A,{columns:X,dataSource:f,scroll:{x:"max-content"},pagination:{pageSize:10},components:{header:{cell:e=>(0,D.jsx)("th",{...e,style:{...e.style,background:"linear-gradient(#000,#000,#000)",color:"white"}})}},loading:F}),(()=>{var e,i,s,l,d,n,r,o,a,u,v,p,h,m,x,A,g,y,j,b,f,I,S,w,N;return(0,D.jsx)(t.A,{title:"Subscription Details",visible:V,onCancel:()=>L(!1),footer:null,width:800,children:(0,D.jsxs)("div",{children:[(0,D.jsxs)(c.A,{bordered:!0,column:2,layout:"horizontal",children:[(0,D.jsx)(c.A.Item,{label:"Product Name",children:null===W||void 0===W||null===(e=W.productId)||void 0===e?void 0:e.productname}),(0,D.jsx)(c.A.Item,{label:"Frequency",children:null===W||void 0===W?void 0:W.frequency}),(0,D.jsx)(c.A.Item,{label:"Start Date",children:new Date(null===W||void 0===W?void 0:W.startDate).toLocaleDateString()}),(0,D.jsx)(c.A.Item,{label:"End Date",children:null!==W&&void 0!==W&&W.endDate?new Date(null===W||void 0===W?void 0:W.endDate).toLocaleDateString():"N/A"}),(0,D.jsx)(c.A.Item,{label:"Total Orders",children:null===W||void 0===W?void 0:W.totalOrders}),(0,D.jsx)(c.A.Item,{label:"Total Quantity",children:null===W||void 0===W?void 0:W.totalQuantity}),(0,D.jsxs)(c.A.Item,{label:"Product Value",children:["\u20b9",null===W||void 0===W||null===(i=W.selectedWeight.price)||void 0===i?void 0:i.toFixed(2)]}),(0,D.jsxs)(c.A.Item,{label:"Delivery Charges",children:["\u20b9",null===W||void 0===W||null===(s=W.deliveryCharges)||void 0===s?void 0:s.toFixed(2)]}),(0,D.jsxs)(c.A.Item,{label:"Total",children:["\u20b9",null===W||void 0===W||null===(l=W.productValue)||void 0===l?void 0:l.toFixed(2)]}),"Customize"!==(null===W||void 0===W?void 0:W.frequency)?(0,D.jsx)(c.A.Item,{label:"Quantity",children:null===W||void 0===W?void 0:W.quantity}):""]}),(0,D.jsx)("h4",{children:"Shipping Address:"}),(0,D.jsxs)(c.A,{bordered:!0,column:1,children:[(0,D.jsx)(c.A.Item,{label:"Full Name",children:null!==W&&void 0!==W&&null!==(d=W.shippingAddress)&&void 0!==d&&d.fullName?null===W||void 0===W||null===(n=W.shippingAddress)||void 0===n?void 0:n.fullName:null===W||void 0===W||null===(r=W.shippingAddress)||void 0===r?void 0:r.name}),(0,D.jsxs)(c.A.Item,{label:"Address",children:[null!==W&&void 0!==W&&null!==(o=W.shippingAddress)&&void 0!==o&&o.street?null===W||void 0===W||null===(a=W.shippingAddress)||void 0===a?void 0:a.street:null===W||void 0===W||null===(u=W.shippingAddress)||void 0===u?void 0:u.address1,","," ",null!==W&&void 0!==W&&null!==(v=W.shippingAddress)&&void 0!==v&&v.city?null===W||void 0===W||null===(p=W.shippingAddress)||void 0===p?void 0:p.city:null===W||void 0===W||null===(h=W.shippingAddress)||void 0===h?void 0:h.address2," ",null!==W&&void 0!==W&&null!==(m=W.shippingAddress)&&void 0!==m&&m.state?",":""," ",null===W||void 0===W||null===(x=W.shippingAddress)||void 0===x?void 0:x.state,","," ",null===W||void 0===W||null===(A=W.shippingAddress)||void 0===A?void 0:A.pincode]}),(0,D.jsx)(c.A.Item,{label:"Phone",children:null!==W&&void 0!==W&&null!==(g=W.shippingAddress)&&void 0!==g&&g.number?null===W||void 0===W||null===(y=W.shippingAddress)||void 0===y?void 0:y.number:null===W||void 0===W||null===(j=W.shippingAddress)||void 0===j?void 0:j.mobile}),(0,D.jsx)(c.A.Item,{label:"Email",children:null===W||void 0===W||null===(b=W.shippingAddress)||void 0===b?void 0:b.email})]}),(0,D.jsx)("h4",{children:"Selected Weight:"}),(0,D.jsx)(c.A,{bordered:!0,column:1,children:(0,D.jsxs)(c.A.Item,{label:"Weight",children:[null===W||void 0===W||null===(f=W.selectedWeight)||void 0===f?void 0:f.value," ",null===W||void 0===W||null===(I=W.selectedWeight)||void 0===I?void 0:I.units]})}),(null===W||void 0===W?void 0:W.pauseDates)&&(null===W||void 0===W||null===(S=W.pauseDates)||void 0===S?void 0:S.length)>0&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("h4",{children:"Pause Dates:"}),(0,D.jsx)(c.A,{bordered:!0,column:1,children:null===W||void 0===W?void 0:W.pauseDates.map(((e,i)=>(0,D.jsx)(c.A.Item,{label:`Pause Date ${i+1}`,children:new Date(e).toLocaleDateString()},i)))})]}),(null===W||void 0===W?void 0:W.deliveryData)&&(null===W||void 0===W||null===(w=W.deliveryData)||void 0===w?void 0:w.length)>0&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Delivery History:"}),(0,D.jsx)("div",{className:"space-y-4",children:null===W||void 0===W||null===(N=W.deliveryData)||void 0===N?void 0:N.map(((e,i)=>(0,D.jsx)("div",{className:"border p-4 rounded-lg shadow-sm",children:(0,D.jsxs)("div",{className:"flex justify-between items-center",children:[(0,D.jsxs)("div",{children:[(0,D.jsxs)("span",{className:"font-medium",children:["Delivery ",i+1]}),(0,D.jsxs)("div",{className:"mt-2",children:[(0,D.jsxs)("p",{className:"text-sm",children:[(0,D.jsx)("span",{className:"font-medium",children:"Driver:"})," ",e.driverName||"N/A"]}),(0,D.jsxs)("p",{className:"text-sm",children:[(0,D.jsx)("span",{className:"font-medium",children:"Status:"})," ",(0,D.jsx)("span",{className:"px-2 py-1 rounded-full text-xs "+("Delivered"===e.status?"bg-green-100 text-green-700":"Pending"===e.status?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"),children:e.status})]}),(0,D.jsx)("button",{className:"text-blue-600 text-sm hover:underline mt-2",onClick:()=>(e=>{K(J===e?null:e)})(i),children:J===i?"Hide Details":"View Details"}),J===i&&(0,D.jsxs)("div",{className:"text-sm mt-2",children:[(0,D.jsxs)("p",{children:[(0,D.jsx)("span",{className:"font-medium",children:"Delivery Type:"})," ",e.deliveryType]}),(0,D.jsxs)("p",{className:"text-sm",children:[(0,D.jsx)("span",{className:"font-medium",children:"Remarks:"})," ",e.remarks||"N/A"]})]})]})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("span",{className:"text-gray-500 text-sm",children:e.date?e.date:"N/A"}),e.proofImg&&(0,D.jsxs)("div",{className:"mt-2",children:[(0,D.jsx)("span",{className:"font-medium",children:"Proof:"}),(0,D.jsx)("a",{href:`https://majesticmall.net/driver/${null===e||void 0===e?void 0:e.proofImg}`,target:"_blank",rel:"noopener noreferrer",children:(0,D.jsx)("img",{src:`https://majesticmall.net/driver/${null===e||void 0===e?void 0:e.proofImg}`,alt:"Delivery Proof",className:"h-24 rounded-lg w-24 mt-1 object-cover"})})]})]})]})},i)))})]}),(null===W||void 0===W?void 0:W.remarks)&&(0,D.jsxs)("div",{children:[(0,D.jsx)("h4",{children:"Remarks:"}),(0,D.jsx)("p",{children:null===W||void 0===W?void 0:W.remarks})]}),(null===W||void 0===W?void 0:W.deliveryProof)&&(0,D.jsxs)("div",{children:[(0,D.jsx)("h4",{children:"Deliver Proof:"}),(0,D.jsx)("img",{src:`https://majesticmall.net/driver/${null===W||void 0===W?void 0:W.deliveryProof}`,alt:"Delivery Proof",style:{borderRadius:"10px",height:"150px",width:"auto"}})]})]})})})(),(0,D.jsx)(t.A,{title:"Edit Subscription",visible:B,onOk:async()=>{try{const e=await Q.validateFields(),{subscriptionId:s}=z;200===(await A.A.post(`${S}/user/updateSubscription/${s}`,e,{headers:{Authorization:`Bearer ${i}`}})).status&&(y.oR.success("Subscription updated successfully"),_(!1),Q.resetFields(),H())}catch(e){y.oR.error("Failed to update subscription"),console.error("Error updating subscription:",e)}},onCancel:()=>{_(!1),Q.resetFields()},children:(0,D.jsxs)(n.A,{form:Q,children:[(0,D.jsx)(n.A.Item,{label:"Frequency",name:"frequency",rules:[{required:!0,message:"Please select frequency!"}],children:(0,D.jsxs)(u.A,{children:[(0,D.jsx)(u.A.Option,{value:"Everyday",children:"Everyday"}),(0,D.jsx)(u.A.Option,{value:"On Interval",children:"On Interval"}),(0,D.jsx)(u.A.Option,{value:"Customize",children:"Customize"})]})}),(0,D.jsx)(n.A.Item,{label:"Start Date",name:"startDate",rules:[{required:!0,message:"Please select start date!"}],children:(0,D.jsx)(p.A,{})}),(0,D.jsx)(n.A.Item,{label:"End Date",name:"endDate",children:(0,D.jsx)(p.A,{})}),(0,D.jsx)(n.A.Item,{label:"Quantity",name:"quantity",rules:[{required:!0,message:"Please input quantity!"}],children:(0,D.jsx)(v.A,{type:"number",min:1})}),"On Interval"===Q.getFieldValue("frequency")&&(0,D.jsx)(n.A.Item,{label:"Interval (days)",name:"nthInterval",rules:[{required:!0,message:"Please input interval!"}],children:(0,D.jsx)(v.A,{type:"number",min:1})}),"Customize"===Q.getFieldValue("frequency")&&(0,D.jsx)(n.A.Item,{label:"Day Quantities",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((e=>(0,D.jsx)(n.A.Item,{name:["dayQuantities",e],noStyle:!0,children:(0,D.jsx)(v.A,{type:"number",min:0,addonBefore:e,style:{width:"150px",marginRight:"8px",marginBottom:"8px"}})},e)))})]})})]})}}}]);
//# sourceMappingURL=957.3f0e9e7b.chunk.js.map